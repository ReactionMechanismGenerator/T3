# After changing this file, check it on:
#   http://lint.travis-ci.org/

language: python

os:
  - linux

python:
  - "3.7"

stages:
  - test

before_install:
  # Setup python environment
  - source devtools/travis_ci_before_install.sh
  - python -V
  # Set git info
  - git config --global user.name "Travis Deploy"
  - git config --global user.email "alongd@mit.edu"

cache: pip

jobs:
  include:
    - stage: test
      install:
        - echo $TRAVIS_OS_NAME
        - export PYTHONPATH=$PYTHONPATH:$(pwd)
        - echo "export PYTHONPATH=$PYTHONPATH:$(pwd)" >> ~/.bashrc
        - conda env create -f environment.yml
        - source activate t3_env
        - make install-arc
        - make install-julia
        - python -c "import pyrms; pyrms.install()"
        - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sed -i 's|bin/python|bin/python3|g' $(which python-jl); fi
        - if [ "$TRAVIS_OS_NAME" == "osx" ]; then sed -i ".bak" 's|bin/python|bin/python3|g' $(which python-jl); fi
        - ln -sfn $(which python-jl) $(which python)
        - echo $PYTHONPATH
        - conda env list
        - echo $PYTHONPATH
        - echo $(pwd)
        - cd ../RMG-Py
        - export PYTHONPATH=$PYTHONPATH:$(pwd)
        - cd ../ARC
        - export PYTHONPATH=$PYTHONPATH:$(pwd)
        - echo $PYTHONPATH
      script:
        - coverage run -m pytest -ra -vv
        - coverage report
        - codecov

notifications:
    email: false
